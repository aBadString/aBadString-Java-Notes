<h1 id="组件化框架" align="center">组件化框架</h1>
<!-- @import "[TOC]" {cmd="toc"} -->

<!-- code_chunk_output -->

- [1. Node](#1-node)
  - [Hello Node](#hello-node)
- [2. React](#2-react)
  - [2.1. UmiJS](#21-umijs)
    - [2.1.1. 创建项目](#211-创建项目)
    - [2.1.2. umi-plugin-react 插件](#212-umi-plugin-react-插件)
  - [2.2. DvaJS](#22-dvajs)

<!-- /code_chunk_output -->

# 1. Node

> Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行时。

> npm是名声最广的前端包管理器，为Node.js自带
> cnpm是npm的阿里版，用的是阿里的源
> yarn的出现是想取代npm包管理工具，特点是快速安全可靠
> tyarn这个是yarn的阿里版，用的是阿里的源

将下载的 zip 解压，并配置好环境变量即可。
```shell
#查看其版本号
> node -v
v14.13.1
# 安装 yarn，其中 tyarn 使用的是 npm.taobao.org 的源，速度要快一些
# 可以把 yarn 看做了优化了的npm
# -g 是指全局安装
npm i yarn tyarn -g

# 进行测试，如果能够正常输出版本信息则说明安装成功了
tyarn -v

# 下面开始安装umi
tyarn global add umi
# 测试
umi
```

- 安装失败，记得用管理员身份安装。
- PowerShell 无法运行 .ps1 脚本的问题：
  原因是 PS 的执行策略为 Restricted。
  `get-executionpolicy` 用于查看当前执行策略。`set-executionpolicy RemoteSigned` 改一下执行策略即可。如果不想改，用 .cmd 后缀的脚本也可以。
  > https:/go.microsoft.com/fwlink/?LinkID=135170 中的 about_Execution_Policies
- umi 找不到命令。环境变量问题，执行 `yarn global bin`；将输出结果 `C:\Users\aBadString\AppData\Local\Yarn\bin` 添加到环境变量。

## Hello Node

1. **编写一个 js 文件**
```js
// 引入依赖：Node.js 的 http 模块
const http = require('http');

const server = http.createServer(
  (req, res) => {
    res.statusCode = 200;
    res.setHeader('Content-Type', 'text/plain');
    res.end('hello, node\n');
  }
);

const hostname = '127.0.0.1';
const port = 3000;
server.listen(
  port,
  hostname,
  () => {
    console.log(`server run in http://${hostname}:${port}/`);
  }
);
```

2. **运行 JS**
```shell
node ./src/01node.HelloNode.js
```

3. **浏览器访问 http://127.0.0.1:3000/**
hello, node

分析


# 2. React

## 2.1. UmiJS

> UmiJS - 插件化的企业级前端应用框架，是一个可插拔的企业级 react 应用框架。

### 2.1.1. 创建项目

1. **创建一个空的目录，或者使用任意 IDE 创建一个空的 Web 项目。**

2. **初始化 `tyarn init -y`**
```shell
> tyarn init -y
yarn init v1.22.10
warning The yes flag has been set. This will automatically answer yes to all questions, which may have security implications.
success Saved package.json
Done in 0.06s.
```
执行结束后，会生成一个 package.json 文件，内容如下：
```json
{
  "name": "javascript",
  "version": "1.0.0",
  "main": "index.js",
  "license": "MIT"
}
```

3. **添加依赖**
```shell
# 项目中添加umi的依赖
tyarn add umi --dev
```
修改了 package.json 文件
```json
{
  "name": "javascript",
  "version": "1.0.0",
  "main": "index.js",
  "license": "MIT",
  "devDependencies": {
    "umi": "^3.2.23"
  }
}
```
添加了一个文件 yarn.lock 和一个文件夹 node_modules（依赖根目录）。

4. **添加全局配置文件**

创建一个文件 config/config.js 作为 UmiJS 的全局配置文件。内容如下：
```js
// 导出一个对象（{}为空，暂时先使用空对象）
export default {};
```

5. **创建目录结构**
> UMI 中约定目录结构如下：
```
.
├── dist/                          // 默认的 build 输出目录
├── mock/                          // mock 文件所在目录，基于 express
├── config/
    ├── config.js                  // umi 配置，同 .umirc.js，二选一
└── src/                           // 源码目录，可选
    ├── layouts/index.js           // 全局布局
    ├── pages/                     // 页面目录，里面的文件即路由
        ├── .umi/                  // dev 临时目录，需添加到 .gitignore
        ├── .umi-production/       // build 临时目录，会自动删除
        ├── document.ejs           // HTML 模板
        ├── 404.js                 // 404 页面
        ├── page1.js               // 页面 1，任意命名，导出 react 组件
        ├── page1.test.js          // 用例文件，umi test 会匹配所有 .test.js 和 .e2e.js 结尾的文件
        └── page2.js               // 页面 2，任意命名
    ├── global.css                 // 约定的全局样式文件，自动引入，也可以用 global.less
    ├── global.js                  // 可以在这里加入 polyfill
    ├── app.js                     // 运行时配置文件
├── .umirc.js                      // umi 配置，同 config/config.js，二选一
├── .env                           // 环境变量
└── package.json
```

创建一个文件 src/pages/HelloReact.js
```js
export default () => {
    return <div>hello, react</div>;
};
```

6. **启动服务**
```shell
umi dev
```
浏览器访问 http://192.168.1.115:8000/HelloReact 或 http://localhost:8000/HelloReact （不要后缀 .js）

根据约定的路由，pages 下的 js 文件都会映射到 `/[文件名]` 下。

7. **转码（部署）**

通过 umi 转码生成最终可部署的文件
```
umi build
```
会在 dist 文件夹下生成目标文件

### 2.1.2. umi-plugin-react 插件

> 该插件是 umi 基于 react 封装的，包含了 13 个常用功能。

1. **添加插件的依赖**
```
tyarn add umi-plugin-react --dev
```
package.json 文件被修改：
```json
{
  "name": "javascript",
  "version": "1.0.0",
  "main": "index.js",
  "license": "MIT",
  "devDependencies": {
    "umi": "^3.2.23",
    "umi-plugin-react": "^1.15.8"
  }
}
```

2. **在配置文件 config/config.js 中启用插件**
```json
export default {
    plugins: [
        ['umi-plugin-react', {}] // {}：为空，暂时不启用任何功能
    ]
};
```

## 2.2. DvaJS

> dva 首先是一个基于 redux 和 redux-saga 的数据流方案，然后为了简化开发体验，dva 还额外内置了 react-router 和 fetch，所以也可以理解为一个轻量级的应用框架。

